{"version":3,"file":"hc-social-triangulation.umd.js","sources":["../src/bindings.ts","../src/graphql/schema.ts","../src/graphql/resolvers.ts","../src/graphql/queries.ts","../src/elements/hcst-agent-list.ts","../src/social-triangulation.module.ts"],"sourcesContent":["export const SocialTriangulationBindings = {\n  SocialTriangulationBindings: \"holochain-social-triangulation-provider\"\n};\n","import gql from 'graphql-tag';\n\nexport const socialTriangulationTypeDefs = gql`\n  extend type Mutation {\n    vouchForAgent(agentId: ID!): Boolean!\n  }\n\n  extend type Agent {\n    vouchesCount: Int!\n    isInitialMember: Boolean!\n  }\n\n  extend type Query {\n    minVouches: Int!\n  }\n`;\n","import { HolochainProvider } from '@uprtcl/holochain-provider';\n\nimport { SocialTriangulationBindings } from '../bindings';\n\nexport const resolvers = {\n  Mutation: {\n    async vouchForAgent(_, { agentId }, { container }) {\n      const socialTriangulationProvider: HolochainProvider = container.get(\n        SocialTriangulationBindings.SocialTriangulationBindings\n      );\n\n      await socialTriangulationProvider.call('vouch_for', {\n        agent_address: agentId,\n      });\n      return true;\n    },\n  },\n  Query: {\n    async minVouches(_, __, { container }) {\n      const socialTriangulationProvider: HolochainProvider = container.get(\n        SocialTriangulationBindings.SocialTriangulationBindings\n      );\n\n      const settings: string = await socialTriangulationProvider.call(\n        'get_setting',\n        {}\n      );\n\n      return settings.split('Minimum_Required_Vouch:')[1];\n    },\n  },\n  Agent: {\n    async isInitialMember(parent, _, { container }) {\n      const socialTriangulationProvider: HolochainProvider = container.get(\n        SocialTriangulationBindings.SocialTriangulationBindings\n      );\n\n      const settings: string = await socialTriangulationProvider.call(\n        'get_setting',\n        {}\n      );\n\n      return settings.includes(parent.id);\n    },\n    async vouchesCount(parent, _, { container }) {\n      const socialTriangulationProvider: HolochainProvider = container.get(\n        SocialTriangulationBindings.SocialTriangulationBindings\n      );\n\n      const numVouches = await socialTriangulationProvider.call(\n        'vouch_count_for',\n        {\n          agent_address: parent.id,\n        }\n      );\n\n      return parseInt(numVouches);\n    },\n  },\n};\n","import gql from 'graphql-tag';\n\nexport const VOUCH_FOR_AGENT = gql`\n  mutation VouchForAgent($agentId: ID!) {\n    vouchForAgent(agentId: $agentId)\n  }\n`;\n","import { moduleConnect } from '@uprtcl/micro-orchestrator';\nimport { LitElement, html, property, css, query } from 'lit-element';\nimport { ApolloClient, gql } from 'apollo-boost';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nimport '@authentic/mwc-circular-progress';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\nimport { VouchedAgent } from '../types';\nimport { VOUCH_FOR_AGENT } from '../graphql/queries';\n\nexport class STAgentList extends moduleConnect(LitElement) {\n  @property({ type: Array })\n  me: VouchedAgent | undefined = undefined;\n\n  @property({ type: Array })\n  agents: VouchedAgent[] | undefined = undefined;\n\n  @property({ type: Number })\n  minVouches!: number;\n\n  client!: ApolloClient<any>;\n\n  static get styles() {\n    return css`\n      .row {\n        display: flex;\n        flex-direction: row;\n      }\n\n      .fill {\n        flex: 1;\n      }\n\n      .padding {\n        padding: 16px;\n      }\n\n      .center-content {\n        justify-content: center;\n        align-items: center;\n      }\n    `;\n  }\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n\n    const result = await this.client.query({\n      query: gql`\n        {\n          me {\n            id\n            username\n            vouchesCount\n            isInitialMember\n          }\n          allAgents {\n            id\n            username\n            vouchesCount\n            isInitialMember\n          }\n          minVouches\n        }\n      `,\n      fetchPolicy: 'network-only',\n    });\n\n    this.agents = result.data.allAgents;\n    this.me = result.data.me;\n    this.minVouches = result.data.minVouches;\n  }\n\n  isAllowed(agent: VouchedAgent) {\n    return agent.isInitialMember || agent.vouchesCount >= this.minVouches;\n  }\n\n  vouchForAgent(agentId: string) {\n    this.client.mutate({\n      mutation: VOUCH_FOR_AGENT,\n      variables: {\n        agentId,\n      },\n    });\n  }\n\n  renderAgent(agent: VouchedAgent) {\n    return html`\n      <div class=\"row\" style=\"align-items: center;\">\n        <mwc-list-item style=\"flex: 1;\" twoline noninteractive>\n          <span>${agent.username}</span>\n          <span slot=\"secondary\">${agent.id}</span>\n        </mwc-list-item>\n\n        <span style=\"margin-right: 16px;\">\n          ${agent.isInitialMember\n            ? 'Initial member'\n            : `Vouch count: ${agent.vouchesCount}`}\n        </span>\n        ${this.isAllowed(this.me as VouchedAgent) && !this.isAllowed(agent)\n          ? html`<mwc-button\n              style=\"padding-right: 16px;\"\n              label=\"VOUCH\"\n              @click=${() => this.vouchForAgent(agent.id)}\n            ></mwc-button>`\n          : html``}\n      </div>\n    `;\n  }\n\n  render() {\n    if (!this.agents)\n      return html`<div class=\"padding center-content row fill\">\n        <mwc-circular-progress></mwc-circular-progress>\n      </div>`;\n\n    return html`\n      <mwc-list>\n        ${this.agents.map(\n          (agent, i) => html`${this.renderAgent(agent)}\n          ${this.agents && i < this.agents.length - 1\n            ? html`<li divider padded role=\"separator\"></li> `\n            : html``} `\n        )}\n      </mwc-list>\n    `;\n  }\n}\n","import { interfaces } from 'inversify';\nimport { GraphQlSchemaModule } from '@uprtcl/graphql';\nimport { MicroModule, i18nextModule } from '@uprtcl/micro-orchestrator';\nimport {\n  HolochainConnectionModule,\n  createHolochainProvider,\n} from '@uprtcl/holochain-provider';\nimport { ProfilesModule } from 'holochain-profiles';\n\nimport en from './i18n/en.json';\nimport { SocialTriangulationBindings } from './bindings';\nimport { socialTriangulationTypeDefs } from './graphql/schema';\nimport { resolvers } from './graphql/resolvers';\nimport { STAgentList } from './elements/hcst-agent-list';\n\nexport class SocialTriangulationModule extends MicroModule {\n  static id = 'holochain-social-triangulation-module';\n\n  dependencies = [HolochainConnectionModule.id, ProfilesModule.id];\n\n  static bindings = SocialTriangulationBindings;\n\n  constructor(protected instance: string) {\n    super();\n  }\n\n  async onLoad(container: interfaces.Container) {\n    const socialTriangulationProvider = createHolochainProvider(\n      this.instance,\n      'social-triangulation'\n    );\n\n    container\n      .bind(SocialTriangulationBindings.SocialTriangulationBindings)\n      .to(socialTriangulationProvider);\n\n    customElements.define('hcst-agent-list', STAgentList);\n  }\n\n  get submodules() {\n    return [\n      new GraphQlSchemaModule(socialTriangulationTypeDefs, resolvers),\n      new i18nextModule('social-triangulation', { en: en }),\n    ];\n  }\n}\n"],"names":["moduleConnect","LitElement","css","ApolloClientModule","gql","html","property","MicroModule","HolochainConnectionModule","ProfilesModule","createHolochainProvider","GraphQlSchemaModule","i18nextModule"],"mappings":"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"}